### 抓包函数返回值解析

res = pcap_next_ex( adhandle, &header, &pkt_data)



header 类型 :pcap_pkthdr

struct pcap_pkthdr {
	struct timeval ts;	/* time stamp */
	bpf_u_int32 caplen;	/* length of portion present */
	bpf_u_int32 len;	/* length this packet (off wire) */
};



### 以太网帧结构

![以太帧结构（格式）](http://c.biancheng.net/uploads/allimg/191106/6-191106130541362.gif)

| 字段           | 含义                                                         |
| -------------- | ------------------------------------------------------------ |
| 前同步码       | 用来使接收端的适配器在接收 MAC 帧时能够迅速调整时钟频率，使它和发送端的频率相同。前同步码为 7 个字节，1 和 0 交替。 |
| 帧开始定界符   | 帧的起始符，为 1 个字节。前 6 位 1 和 0 交替，最后的两个连续的 1 表示告诉接收端适配器：“帧信息要来了，准备接收”。 |
| 目的地址       | 接收帧的网络适配器的物理地址（MAC 地址），为 6 个字节（48 比特）。作用是当网卡接收到一个数据帧时，首先会检查该帧的目的地址，是否与当前适配器的物理地址相同，如果相同，就会进一步处理；如果不同，则直接丢弃。 |
| 源地址         | 发送帧的网络适配器的物理地址（MAC 地址），为 6 个字节（48 比特）。 |
| 类型           | 上层协议的类型。由于上层协议众多，所以在处理数据的时候必须设置该字段，标识数据交付哪个协议处理。例如，字段为 0x0800 时，表示将数据交付给 IP 协议。 |
| 数据           | 也称为效载荷，表示交付给上层的数据。以太网帧数据长度最小为 46 字节，最大为 1500 字节。如果不足 46 字节时，会填充到最小长度。最大值也叫最大传输单元（MTU）。  在 Linux 中，使用 ifconfig 命令可以查看该值，通常为 1500。 |
| 帧检验序列 FCS | 检测该帧是否出现差错，占 4 个字节（32 比特）。发送方计算帧的循环冗余码校验（CRC）值，把这个值写到帧里。接收方计算机重新计算 CRC，与 FCS 字段的值进行比较。如果两个值不相同，则表示传输过程中发生了数据丢失或改变。这时，就需要重新传输这一帧。 |



### tcp包数据结构

![img](https://img-blog.csdn.net/20181015142113271?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzI3MjE4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

### ARP报文结构

ARP报文分为ARP请求和ARP应答报文

  硬件类型：表示硬件地址的类型。它的值为1表示以太网地址；

 协议类型：表示要映射的协议地址类型。它的值为0x0800即表示IP地址；

  硬件地址长度和协议地址长度分别指出硬件地址和协议地址的长度，以字节为单位。对于以太网上IP地址的ARP请求或应答来说，它们的值分别为6和4；

 操作类型（OP）：1表示ARP请求，2表示ARP应答；

 发送端MAC地址：发送方设备的硬件地址；

 发送端IP地址：发送方设备的IP地址；

  目标MAC地址：接收方设备的硬件地址。

目标IP地址：接收方设备的IP地址。 



硬件类型、协议类型、迎接类型长度、协议类型长度、操作类型、源mac地址、源ip地址、目的mac地址、目的ip地址
